name: Deploy via PR from mobile_drop
on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  deploy-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: fetch-depth: 0

      - name: Prepare tools
        run: sudo apt-get update && sudo apt-get install -y unzip rsync

      - name: Ensure mobile_drop zip available
        run: |
          mkdir -p mobile_drop
          if [ -f "ETHRION_v3.4_MobileReady_Full.zip" ]; then cp ETHRION_v3.4_MobileReady_Full.zip mobile_drop/ || true; fi
          ls -la mobile_drop

      - name: Unzip site zip
        run: |
          shopt -s nullglob
          for z in mobile_drop/*.zip; do unzip -o "$z" -d mobile_drop/_unzipped; done
          if [ ! -d mobile_drop/_unzipped ]; then echo "No zip found" && exit 1; fi

      - name: Restore folder names from __ pattern
        run: |
          SRC="mobile_drop
